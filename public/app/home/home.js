angular.module("main").controller("homeController",["$scope","appFactory",function($scope,appFactory){appFactory.init($scope),$scope.events=[];var ref=appFactory.firebase,eventsRef=ref.child("events");eventsRef.orderByChild("date").limitToLast(200).on("child_added",function(snapshot){var data=snapshot.val();data.key=snapshot.key(),appFactory.update($scope,function(scope){data.image=data.image||"./assets/albumcover.png",scope.events.push(data)})}),$scope.saveDate=function(title,host,eventKey){$scope.list=[],userRef=ref.child("users").child(ref.getAuth().uid),userRef.child("currentEvents").child(eventKey).update({title:title,host:host})},$scope.dateView={},$scope.dateView.futureView=!0,$scope.dateView.pastView=!1,$scope.dateView.customDateView=!1,$scope.isReverse=!1,$scope.viewFutureEvents=function(){$scope.dateView.futureView||($scope.dateView.futureView=!0,$scope.dateView.pastView=!1,$scope.dateView.customDateView=!1,$scope.isReverse=!1)},$scope.viewPastEvents=function(){$scope.dateView.pastView||($scope.dateView.pastView=!0,$scope.dateView.futureView=!1,$scope.dateView.customDateView=!1,$scope.isReverse=!0)},$scope.viewDateFilter=function(){$scope.dateView.customDateView||($scope.dateView.customDateView=!0,$scope.dateView.futureView=!1,$scope.dateView.pastView=!1,$scope.isReverse=!1)},$scope.numLimit=20,$scope.increaseNumLimit=function(){$scope.numLimit+=20},$scope.showMoreButton=!1,$scope.genres=appFactory.genres,$scope.chosenGenres=appFactory.chosenGenres,$scope.chooseGenre=appFactory.chooseGenre,$scope.showGenres=!1,$scope.showGenresNow=function(){$scope.showGenres=!$scope.showGenres},$scope.debounce=200,$scope.dateFilter=appFactory.dateFilter,$scope.genreFilter=appFactory.genreFilter,$scope.textFilter=appFactory.textFilter,$scope.filteredEvents=function(events){return $scope.eventsLength=0,events.filter(function(event){var show=$scope.dateFilter(event.date,$scope.dateView);return show&&$scope.chosenGenres&&(show=$scope.genreFilter(event.genre,$scope.chosenGenres)),show&&$scope.filterByTitle&&(show=$scope.textFilter(event.title,$scope.filterByTitle)),show&&$scope.filterByUser&&(show=$scope.textFilter(event.host,$scope.filterByUser)),show&&$scope.eventsLength++,$scope.showMoreButton=$scope.eventsLength>$scope.numLimit,show})}}]).directive("mouseOver",function(){return{link:function(scope,element,attr){element.on("mouseover",function(event){element[0].children[1].style.top="0px",element[0].children[2].style.top="0px",element[0].children[2].style.opacity=.8,element[0].children[2].style.filter="alpha(opacity=80)"}),element.on("mouseleave",function(event){element[0].children[1].style.top="150px",element[0].children[2].style.top="150px",element[0].children[2].style.opacity=.5,element[0].children[2].style.filter="alpha(opacity=50)",$(".eventInfo").animate({scrollTop:0},300)})}}});